<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2020-11-27 Fri 17:40 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>使用docker搭建板砖环境 (Lnmp)</title>
<meta name="generator" content="Org mode">
<link rel="stylesheet" type="text/css" href="style.css" />
</head>
<body>
<div id="content">
<h1 class="title">使用docker搭建板砖环境 (Lnmp)</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org8b5c950">安装</a>
<ul>
<li><a href="#org6442a71">加入用户组</a></li>
<li><a href="#org76233c5">加速源</a></li>
</ul>
</li>
<li><a href="#orge48f7b2">拉取镜像</a></li>
<li><a href="#org943cda2">创建项目</a>
<ul>
<li><a href="#org89a9ec6">安装tp框架</a></li>
</ul>
</li>
<li><a href="#org28ebd5c">启动容器</a></li>
<li><a href="#org7eebb63">phpMyAdmin</a></li>
<li><a href="#org2f23de1">容器停止后的启动顺序</a></li>
<li><a href="#org2a3fea0">TL;DR</a></li>
</ul>
</div>
</div>
<div id="outline-container-org8b5c950" class="outline-2">
<h2 id="org8b5c950">安装</h2>
<div class="outline-text-2" id="text-org8b5c950">
<div class="org-src-container">
<pre class="src src-bash">sudo pacman -S docker
</pre>
</div>
</div>
<div id="outline-container-org6442a71" class="outline-3">
<h3 id="org6442a71">加入用户组</h3>
<div class="outline-text-3" id="text-org6442a71">
<div class="org-src-container">
<pre class="src src-bash">sudo usermod -aG docker $USER
</pre>
</div>
</div>
</div>
<div id="outline-container-org76233c5" class="outline-3">
<h3 id="org76233c5">加速源</h3>
<div class="outline-text-3" id="text-org76233c5">
<p>
编辑 <code>/etc/docker/daemon.json</code> 加入<br>
</p>
<pre class="example">
{
"registry-mirrors": ["https://docker.mirrors.ustc.edu.cn/"]
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orge48f7b2" class="outline-2">
<h2 id="orge48f7b2">拉取镜像</h2>
<div class="outline-text-2" id="text-orge48f7b2">
<div class="org-src-container">
<pre class="src src-bash">docker pull nginx
docker pull mysql:5.6
docker pull php:7.4-fpm
docker pull composer
docker pull phpmyadmin/phpmyadmin
</pre>
</div>
</div>
</div>
<div id="outline-container-org943cda2" class="outline-2">
<h2 id="org943cda2">创建项目</h2>
<div class="outline-text-2" id="text-org943cda2">
<div class="org-src-container">
<pre class="src src-bash">mkdir -p ~/webstack/php-develop/nginx/www/
mkdir -p ~/webstack/php-develop/nginx/conf/conf.d/
cd ~/webstack/php-develop/nginx/www/
</pre>
</div>
</div>
<div id="outline-container-org89a9ec6" class="outline-3">
<h3 id="org89a9ec6">安装tp框架</h3>
<div class="outline-text-3" id="text-org89a9ec6">
<div class="org-src-container">
<pre class="src src-bash">docker run --rm --interactive --tty \
--volume $PWD:/app \
composer create-project topthink/think tp6
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org28ebd5c" class="outline-2">
<h2 id="org28ebd5c">启动容器</h2>
<div class="outline-text-2" id="text-org28ebd5c">
<div class="org-src-container">
<pre class="src src-bash">docker run --name php-fpm -v ~/webstack/php-develop/nginx/www:/www -d php:7.4-fpm
docker run --name nginx -p 8082:80 -d \
-v ~/webstack/php-develop/nginx/www:/usr/share/nginx/html:ro \
-v ~/webstack/php-develop/nginx/log:/var/log/nginx \
-v ~/webstack/php-develop/nginx/conf/conf.d:/etc/nginx/conf.d:ro \
--link php-fpm:php \
nginx
docker run --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=youpasswd -d mysql:5.6
</pre>
</div>
</div>
</div>
<div id="outline-container-org7eebb63" class="outline-2">
<h2 id="org7eebb63">phpMyAdmin</h2>
<div class="outline-text-2" id="text-org7eebb63">
<div class="org-src-container">
<pre class="src src-bash">docker run --name phpmyadmin -p 8083:80 --link mysql:db -d phpmyadmin/phpmyadmin:latest
</pre>
</div>
</div>
</div>
<div id="outline-container-org2f23de1" class="outline-2">
<h2 id="org2f23de1">容器停止后的启动顺序</h2>
<div class="outline-text-2" id="text-org2f23de1">
<p>
<code>docker stop phpmyadmin mysql nginx php-fpm</code><br>
<code>php-fpm</code> -&gt; <code>nginx</code> -&gt; <code>mysql</code> -&gt; <code>phpmyadmin</code><br>
</p>
</div>
</div>
<div id="outline-container-org2a3fea0" class="outline-2">
<h2 id="org2a3fea0">TL;DR</h2>
<div class="outline-text-2" id="text-org2a3fea0">
<p>
<span class="underline">极度讨厌Python，所以不会使用docker compose，即使迫不得已也不会让它运行在宿主机</span><br>
</p>
</div>
</div>
</div>
</body>
</html>
